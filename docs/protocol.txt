========
报文规约
========

1. 跟踪服务器通信报文
---------------------

1) 存储服务器向跟踪服务器请求加入
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+-----------------------------------------+
|         包头         |                  包体                   |
+--------+--------+----+----+----+------+------+--------+--------+
|包体长度|命令(10)|状态|版本|组名|主机名|端口号|启动时间|加入时间|
+--------+--------+----+----+----+------+------+--------+--------+
|    8   |    1   |  1 |                包体长度                 |
+--------+--------+----+-----------------------------------------+

成功响应：

+-----------------------+
|         包头          |
+--------+---------+----+
|包体长度|命令(100)|状态|
+--------+---------+----+
|    8   |    1    |  1 |
+--------+---------+----+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(100)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

2) 存储服务器向跟踪服务器发送心跳
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+-----------+
|         包头         |   包体    |
+--------+--------+----+----+------+
|包体长度|命令(11)|状态|组名|主机名|
+--------+--------+----+----+------+
|    8   |    1   |  1 | 包体长度  |
+--------+--------+----+-----------+

成功响应：

+-----------------------+
|         包头          |
+--------+---------+----+
|包体长度|命令(100)|状态|
+--------+---------+----+
|    8   |    1    |  1 |
+--------+---------+----+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(100)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

3) 客户机从跟踪服务器获取存储服务器地址列表
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+--------------------+
|         包头         |        包体        |
+--------+--------+----+------+------+------+
|包体长度|命令(12)|状态|应用ID|用户ID|文件ID|
+--------+--------+----+------+------+------+
|    8   |    1   |  1 |  16  |  256 |  128 |
+--------+--------+----+------+------+------+

成功响应：

+-----------------------+-----------------------+
|         包头          |         包体          |
+--------+---------+----+----+------------------+
|包体长度|命令(100)|状态|组名|存储服务器地址列表|
+--------+---------+----+----+------------------+
|    8   |    1    |  1 |       包体长度        |
+--------+---------+----+-----------------------+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(100)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

4) 客户机从跟踪服务器获取组列表
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+
|         包头         |
+--------+--------+----+
|包体长度|命令(13)|状态|
+--------+--------+----+
|    8   |    1   |  1 |
+--------+--------+----+

成功响应：

+-----------------------+--------+
|         包头          |  包体  |
+--------+---------+----+--------+
|包体长度|命令(100)|状态| 组列表 |
+--------+---------+----+--------+
|    8   |    1    |  1 |包体长度|
+--------+---------+----+--------+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(100)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

2. ID服务器通信报文
-------------------

1) 存储服务器从ID服务器获取ID
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+----+
|         包头         |包体|
+--------+--------+----+----+
|包体长度|命令(40)|状态|ID键|
+--------+--------+----+----+
|    8   |    1   |  1 |64+1|
+--------+--------+----+----+

成功响应：

+-----------------------+----+
|         包头          |包体|
+--------+---------+----+----+
|包体长度|命令(101)|状态|ID值|
+--------+---------+----+----+
|    8   |    1    |  1 |  8 |
+--------+---------+----+----+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(101)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

3. 存储服务器通信报文
---------------------

1) 客户机向存储服务器上传文件
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+--------------------------------------+
|         包头         |                 包体                 |
+--------+--------+----+------+------+------+--------+--------+
|包体长度|命令(70)|状态|应用ID|用户ID|文件ID|文件大小|文件内容|
+--------+--------+----+------+------+------+--------+--------+
|    8   |    1   |  1 |  16  |  256 |  128 |    8   |文件大小|
+--------+--------+----+------+------+------+--------+--------+

成功响应：

+-----------------------+
|         包头          |
+--------+---------+----+
|包体长度|命令(102)|状态|
+--------+---------+----+
|    8   |    1    |  1 |
+--------+---------+----+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(102)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

2) 客户机向存储服务器询问文件大小
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+--------------------+
|         包头         |        包体        |
+--------+--------+----+------+------+------+
|包体长度|命令(71)|状态|应用ID|用户ID|文件ID|
+--------+--------+----+------+------+------+
|    8   |    1   |  1 |  16  |  256 |  128 |
+--------+--------+----+------+------+------+

成功响应：

+-----------------------+--------+
|         包头          |  包体  |
+--------+---------+----+--------+
|包体长度|命令(102)|状态|文件大小|
+--------+---------+----+--------+
|    8   |    1    |  1 |    8   |
+--------+---------+----+--------+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(102)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

3) 客户机从存储服务器下载文件
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+------------------------------+
|         包头         |             包体             |
+--------+--------+----+------+------+------+----+----+
|包体长度|命令(72)|状态|应用ID|用户ID|文件ID|偏移|大小|
+--------+--------+----+------+------+------+----+----+
|    8   |    1   |  1 |  16  |  256 |  128 |  8 |  8 |
+--------+--------+----+------+------+------+----+----+

成功响应：

+-----------------------+--------+
|         包头          |  包体  |
+--------+---------+----+--------+
|包体长度|命令(102)|状态|文件内容|
+--------+---------+----+--------+
|    8   |    1    |  1 |内容大小|
+--------+---------+----+--------+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(102)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+

4) 客户机要求删除存储服务器上的文件
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

请求：

+----------------------+--------------------+
|         包头         |        包体        |
+--------+--------+----+------+------+------+
|包体长度|命令(73)|状态|应用ID|用户ID|文件ID|
+--------+--------+----+------+------+------+
|    8   |    1   |  1 |  16  |  256 |  128 |
+--------+--------+----+------+------+------+

成功响应：

+-----------------------+
|         包头          |
+--------+---------+----+
|包体长度|命令(102)|状态|
+--------+---------+----+
|    8   |    1    |  1 |
+--------+---------+----+

失败响应：

+-----------------------+---------------+
|         包头          |     包体      |
+--------+---------+----+------+--------+
|包体长度|命令(102)|状态|错误号|错误描述|
+--------+---------+----+------+--------+
|    8   |    1    |  1 |   2  | <=1024 |
+--------+---------+----+------+--------+
