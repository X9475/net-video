========
库表结构
========

1. 跟踪服务器数据库：tnv_trackerdb
----------------------------------

t_groups_info
+----+------------+---------------------+---------------------+
| id | group_name | create_time         | update_time         |
+----+------------+---------------------+---------------------+
|  1 | group001   | 2023-06-30 14:06:13 | 2023-06-30 14:06:13 |
+----+------------+---------------------+---------------------+

t_router
+----+---------+--------+------------+---------------------+---------------------+
| id | appid   | userid | group_name | create_time         | update_time         |
+----+---------+--------+------------+---------------------+---------------------+
|  1 | tnvideo | tnv001 | group001   | 2023-06-30 14:37:31 | 2023-06-30 14:37:31 |
+----+---------+--------+------------+---------------------+---------------------+

跟踪服务器在处理来自客户机的，获取存储服务器地址列表的请求时，先查询t_router表，根据用户ID(userid)获取其对应的组名(group_name)，再于该组中查
找处于活动状态的存储服务器。若t_router表中没有与该用户对应的组，则从t_groups_info表中获取全部组名，随机抽取一个，分配给该用户，并记入t_router表。

2. ID服务器数据库：tnv_idsdb
----------------------------

t_id_gen
+---------+----------+---------------------+---------------------+
| id      | id_value | create_time         | update_time         |
+---------+----------+---------------------+---------------------+
| ../data |      100 | 2023-06-30 14:37:31 | 2023-06-30 14:37:31 |
+---------+----------+---------------------+---------------------+

ID服务器采用键(id)值(id_value)对的形式管理保存在每个存储路径下的文件的ID号。该ID号将参与生成文件在存储路径下的各级子目录和文件名，如：

../data/000/000/000/5F9E3FA7_000
\_____/ \_/ \_/ \_/ \______/ \_/
   |     |___|___|_____|______|_________
   v                   v                v
存储路径            时间戳   源自ID服务器生成的文件ID

针对与每个键相对应的ID值，ID服务器采取内存累加，数据库步进的方式，同时兼顾唯一性和效率。

内  存： 0 1 2 ... 99 100 101 102 ... 199 200 201 202 ...
数据库：100           100                 200
                      200                 300

3. 存储服务器数据库：tnv_storagedb
----------------------------------

t_file_01
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| id                                   | appid   | userid | status | file_path                        | file_size | create_time         | update_time         |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+

t_file_02
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| id                                   | appid   | userid | status | file_path                        | file_size | create_time         | update_time         |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| 649e782b035ee5136ad6ff2c8d2101000115 | tnvideo | tnv001 |      0 | ../data/000/000/000/649E782B_000 |   9316101 | 2023-06-30 14:37:31 | 2023-06-30 14:37:31 |
| 649e818806c75c30b2d2414c779a3d000169 | tnvideo | tnv001 |      0 | ../data/000/000/000/649E8188_001 |  54342651 | 2023-06-30 15:17:28 | 2023-06-30 15:17:28 |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+

t_file_03
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| id                                   | appid   | userid | status | file_path                        | file_size | create_time         | update_time         |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+

t_file_xx表记录了文件ID(id)和路径(file_path)及大小(file_size)的对应关系。这里的文件ID并非由ID服务器生成，而是客户端提供的便于日后访问该文件的标识
号。为了保证其唯一性，在算法中包含了用户ID、进程ID、线程ID、时间戳、计数值和随机量等信息。

用户ID 进程ID 线程ID 随机数
\_________________________/
             |MD5
             v
   时间戳 数字摘要 计数值 随机数
   \___________________________/
                 |
                 v
              文件ID

不同用户上传的文件会被记录在不同的表中，表名的最后两个字符(xx)，由用户ID的哈希值计算得到。
